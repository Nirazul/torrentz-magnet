function Torrent(e,t,n){if(this.link=e,this.name=t,n)this.parseTrackers(),this.linkElement=document.createElement("dl"),this.linkElement.innerHTML='<dt><a href="'+this.getMagnetURI()+'"><span class="u magnet" style="background-image:url('+magnetLogoURL+');">Magnet</span></a></dt>';else{var r=this;this.linkElement=document.createElement("a"),this.linkElement.setAttribute("href",this.getMagnetURI()),this.linkElement.setAttribute("title","Fetching trackers..."),this.linkElement.setAttribute("class","magnet"),this.linkElement.innerHTML='<img src="'+magnetLogoURL+'" />',this.linkElement.addEventListener("mouseover",function(){r.trackers||(r.timeout=setTimeout(function(){r.getTrackers()},100))}),this.linkElement.addEventListener("mouseout",function(){r.timeout&&clearTimeout(r.timeout)})}}var magnetLogoURL=chrome.extension.getURL("icon16.png");Torrent.prototype={getMagnetURI:function(){var e=this.trackers?"&tr="+this.trackers.join("&tr="):"";return"magnet:?xt=urn:btih:"+this.getHash()+"&dn="+encodeURI(this.name)+e},parseTrackers:function(e){this.trackers=[];for(var t=e?(new DOMParser).parseFromString(e,"text/html"):document,n=t.querySelectorAll(".trackers dl dt a"),r=0;r<n.length;r++)this.trackers.push(n[r].innerText)},getTrackers:function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.link,!0),t.onload=function(){t.status>=200&&t.status<400&&(e.parseTrackers(t.responseText),e.linkElement.setAttribute("href",e.getMagnetURI()),e.linkElement.setAttribute("title","Trackers added!"),e.linkElement.style.opacity=1)},t.send()},getHash:function(){return this.link.replace(/\//g,"")}};var pathName=location.pathname.replace(/\//g,"");if(40===pathName.length){var name=document.querySelector(".download h2 span").innerHTML.replace(/<[^>]*>/g,""),torrent=new Torrent(location.href,name,!0);document.querySelector(".download dl").insertAdjacentElement("afterend",torrent.linkElement)}else if(pathName.match(/search/i))for(var searchItems=document.querySelectorAll(".results dl"),i=0;i<searchItems.length;i++){var currentItem=searchItems[i],link=currentItem.querySelector("dt a"),torrent=new Torrent(link.getAttribute("href"),link.innerHTML.replace(/<[^>]*>/g,""));torrent.linkElement=currentItem.querySelector("dt").appendChild(torrent.linkElement)}